C51 COMPILER V9.54   UART0_APP                                                             04/27/2019 11:57:08 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE UART0_APP
OBJECT MODULE PLACED IN UART0_app.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\keil\C51\BIN\C51.EXE UART0_app.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND
                    - TABS(2)

line level    source

   1          
   2          /*------------------------------------------------------------------*/
   3          /* --- STC MCU International Limited -------------------------------*/
   4          /* --- STC 1T Series MCU Programme Demo ----------------------------*/
   5          /* --- Fax: 86-755-82944243 ----------------------------------------*/
   6          /* --- Tel: 86-755-82948412 ----------------------------------------*/
   7          /* --- Web: www.STCMCU.com -----------------------------------------*/
   8          /* If you want to use the program or the program referenced in the  */
   9          /* article, please specify in which data and procedures from STC    */
  10          /*------------------------------------------------------------------*/
  11          
  12          /*      本程序经过测试完全正常, 不提供电话技术支持, 如不能理解, 请自行补充相关基础.  */
  13          
  14          
  15          /*************  本程序功能说明  **************
  16            测试方法：
  17          
  18            根据您的主时钟和波特率修改下面的相关定义，编译后下载到MCU。
  19          
  20            通过串口助手向MCU发送数据，MCU收到后原样返回。
  21          */
  22          
  23          #include  <reg51.h>
  24          
  25          sfr AUXR = 0x8E;
  26          
  27          #define   BUF_LENTH 128   //定义串口接收缓冲长度
  28          unsigned char   RX0_Cnt;
  29          unsigned char RX0_TimerOut;
  30          unsigned char   xdata RX0_Buffer[BUF_LENTH];
  31          bit   B_TI;
  32          
  33          void  uart0_init(void);
  34          
  35          
  36          
  37          /*************** 用户定义参数 *****************************/
  38          
  39          #define MAIN_Fosc   11059200L //define main clock
  40          #define Baudrate0   9600    //define the baudrate,
  41                            //12T mode: 600~115200 for 22.1184MHZ, 300~57600 for 11.0592MHZ
  42                            //1T  mode: 7200~1382400 for 22.1184MHZ, 3600~691200 for 11.0592MHZ
  43          
  44          /**********************************************************/
  45          
  46          
  47          /****************** 编译器自动生成，用户请勿修改 ************************************/
  48          
  49          #define T1_TimerReload    (256 - MAIN_Fosc / 192 / Baudrate0)   //Calculate the timer1 reload value at 12T mo
             -de
  50          //#define T1_TimerReload  (256 - MAIN_Fosc / 16 / Baudrate0)    //Calculate the timer1 reload value ar 1T mod
             -e
  51          
  52          #define TimeOut       (28800 / (unsigned long)Baudrate0 + 2)
C51 COMPILER V9.54   UART0_APP                                                             04/27/2019 11:57:08 PAGE 2   

  53          /**********************************************************/
  54          
  55          
  56          void  main(void)
  57          {
  58   1        unsigned char i;
  59   1        unsigned int  j;
  60   1        uart0_init();
  61   1        
  62   1        while(1)
  63   1        {
  64   2          for(j=0; j<1500; j++) ; //14T per loop, delay 1ms
  65   2          if(RX0_TimerOut != 0)
  66   2          {
  67   3            if(--RX0_TimerOut == 0)
  68   3            {
  69   4              if(RX0_Cnt != 0)
  70   4              {
  71   5                for(i=0; i<RX0_Cnt; i++)
  72   5                {
  73   6                  B_TI = 0;
  74   6                  SBUF = RX0_Buffer[i];
  75   6                  while(!B_TI)  ;
  76   6                  B_TI = 0;
  77   6                }
  78   5              }
  79   4              RX0_Cnt = 0;
  80   4            }
  81   3          }
  82   2        }
  83   1      }
  84          
  85          
  86          
  87          void  uart0_init(void)
  88          {
  89   1        PCON |= 0x80;   //UART0 Double Rate Enable
  90   1        SCON = 0x50;    //UART0 set as 10bit , UART0 RX enable
  91   1        TMOD &= ~(1<<6);    //Timer1 Set as Timer, 12T
  92   1        TMOD = (TMOD & ~0x30) | 0x20; //Timer1 set as 8 bits auto relaod
  93   1      //  AUXR |=  (1<<6);    //Timer1 set as 1T mode
  94   1        TH1 = T1_TimerReload;   //Load the timer
  95   1        TR1  = 1;
  96   1        ES  = 1;
  97   1        EA = 1;
  98   1      }
  99          
 100          
 101          /**********************************************/
 102          void UART0_RCV (void) interrupt 4
 103          {
 104   1        if(RI)
 105   1        {
 106   2          RI = 0;
 107   2          if(RX0_Cnt >= BUF_LENTH)    RX0_Cnt = 0;
 108   2          RX0_Buffer[RX0_Cnt++] = SBUF;
 109   2          RX0_TimerOut = TimeOut; //5ms time out for >= 4800
 110   2        }
 111   1      
 112   1        if(TI)
 113   1        {
 114   2          TI = 0;
C51 COMPILER V9.54   UART0_APP                                                             04/27/2019 11:57:08 PAGE 3   

 115   2          B_TI = 1;
 116   2        }
 117   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    157    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    128    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
