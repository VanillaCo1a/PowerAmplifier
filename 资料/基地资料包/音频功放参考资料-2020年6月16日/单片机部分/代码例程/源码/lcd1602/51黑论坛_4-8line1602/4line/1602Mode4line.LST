C51 COMPILER V9.54   1602MODE4LINE                                                         05/07/2019 17:01:38 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE 1602MODE4LINE
OBJECT MODULE PLACED IN 1602Mode4line.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\keil\C51\BIN\C51.EXE 1602Mode4line.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEX
                    -TEND TABS(2)

line level    source

   1          #include "stc12c5410ad.h"
   2          #include "intrins.h"
   3          
   4          #define uchar unsigned char 
   5          #define uint unsigned int
   6          uchar dis1[]={"    welcome     "};
   7          uchar dis2[]={"   4line Mode   "};
   8          
   9          /***********************************************************/
  10          /***********************************************************/
  11          /***********************************************************/                    //
  12          #define   LcdMode4       1     // 选择4线 为1   则为0
  13          #define   LcdMode8       0     // 选择8线 为1   则为0
  14          #define   LineMode4   0x28     // zz1d nfxx d=1是8线   d=0是4线  n=0是1行  n=1是2行 f=0是5x7 f=1是5x10                
             -                            
  15          #define   LineMode8   0x38     // zz1d nfxx d=1是8线   d=0是4线  n=0是1行  n=1是2行 f=0是5x7 f=1是5x10
  16          #define   Display_ON    0x0c     // zzzz 1dcb   d=1开显示  c=1有光标  b=1光标不闪     显示开，有光标 不闪
  17          #define   Display_OFF   0x08     // zzzz 1dcb   d=1开显示  c=1有光标  b=1光标不闪     显示开，有光标 不闪
  18          #define   EntryMode   0x06     // 显示光标移动设置
  19          #define   LcdClear    0x01     //清屏                           
  20          
  21          
  22          /***********************************************************/
  23          /*************** LCD1602脚位定义  **************************/
  24          /***********************************************************/
  25          #if LcdMode4>0         //4线改这里
  26          
  27          
  28          sbit LcdRs = P0^0;
  29          sbit LcdRw = P0^1;
  30          sbit LcdEn = P0^2;
  31          
  32          
  33          #define lcdDat P0      //xx0000xx
  34          
  35          #endif
  36          #if LcdMode8>0
                            //8线改这里
              sbit LcdEn = P2^7;
              sbit LcdRs = P2^6;
              sbit LcdRw = P2^5;
              #define lcdDat P0
              
              #endif
  44          /***********************************************************/
  45          /***********************************************************/
  46          /***********************************************************/
  47          void Lcddelay(uint us){
  48   1        uint i;
  49   1        for(i=0;i<us;i++){
  50   2          _nop_();
  51   2          _nop_();  
  52   2        }
  53   1      }
C51 COMPILER V9.54   1602MODE4LINE                                                         05/07/2019 17:01:38 PAGE 2   

  54          /***********************************************************/
  55          /***********************************************************/
  56          /***********************************************************/
  57          
  58          
  59          bit Check_Busy()
  60          {                         
  61   1        bit result;
  62   1        LcdRs = 0;
  63   1        LcdRw = 1;
  64   1        LcdEn = 1;
  65   1      #if LcdMode4>0
  66   1        result = (bit)(lcdDat>>7);   //检测P0最高位是否为1
  67   1      #endif
  68   1      #if LcdMode8>0
                result = (bit)(lcdDat & 0x80);   //检测P0最高位是否为1
              #endif
  71   1        LcdEn = 0;
  72   1        return result;//返回侧忙结果
  73   1      }
  74          
  75          
  76          void LcdWriteBety(uchar dat1,uchar btey){//btey=1  写数据   btey=0 写指令
  77   1      //  while(Check_Busy());       //LcdRw 不用要屏蔽掉查忙
  78   1        if(btey==0){
  79   2          LcdRs = 0;  }
  80   1        else{
  81   2          LcdRs = 1;  } 
  82   1        LcdRw = 0;
  83   1      #if LcdMode4>0 
  84   1        LcdEn = 0;  
  85   1        lcdDat= (dat1>>4);   //  1111 1111  先高
  86   1        LcdEn = 1;
  87   1      //  Lcddelay(13);      //不用时钟分频延时要用  c51不用
  88   1        _nop_();
  89   1        LcdEn = 0;
  90   1        LcdEn = 0;
  91   1        lcdDat= (dat1<<4);   //再低
  92   1        LcdEn = 1;
  93   1      //  Lcddelay(11);      //不用时钟分频延时要用  c51不用
  94   1        _nop_();
  95   1        LcdEn = 0;
  96   1      
  97   1      #endif    
  98   1      #if LcdMode8>0
              
                lcdDat= dat1;
                LcdEn = 1; 
                _nop_();
                LcdEn = 0;
              
              #endif
 106   1      }
 107          /***********************************************************/
 108          /***********************************************************/
 109          /***********************************************************/
 110          void LcdInit(void){
 111   1        #if LcdMode4>0
 112   1        LcdWriteBety(LineMode4,0);
 113   1        Lcddelay(20);
 114   1        LcdWriteBety(LineMode4,0);
 115   1        
C51 COMPILER V9.54   1602MODE4LINE                                                         05/07/2019 17:01:38 PAGE 3   

 116   1        #endif
 117   1        #if LcdMode8>0
                LcdWriteBety(LineMode8,0);
                Lcddelay(20);
                LcdWriteBety(LineMode8,0);
                #endif
 122   1        Lcddelay(20);
 123   1        LcdWriteBety(Display_ON,0);
 124   1        Lcddelay(10);
 125   1        LcdWriteBety(EntryMode,0);
 126   1        Lcddelay(10);
 127   1        LcdWriteBety(LcdClear,0);
 128   1        Lcddelay(10);
 129   1      }
 130          /***********************************************************/
 131          /***********************************************************/
 132          /***********************************************************/            
 133          void LcdPos(uchar x,uchar y){
 134   1        if(y==1) x=0x80+x-1;
 135   1        if(y==2) x=0xc0+x-1;
 136   1        LcdWriteBety(x,0);
 137   1      }
 138          /***********************************************************/
 139          /***********************************************************/
 140          /***********************************************************/
 141          void LcdClread(){
 142   1        LcdWriteBety(LcdClear,0);
 143   1        Lcddelay(1500);
 144   1      }
 145          /***********************************************************/
 146          /***********************************************************/
 147          /***********************************************************/
 148          void WriteStr(uchar x,uchar y,uchar *str){ 
 149   1      
 150   1        LcdPos(x,y);
 151   1        while(*str!='\0'){
 152   2          LcdWriteBety(*str++,1);
 153   2        }
 154   1      }
 155          /***********************************************************/
 156          /***********************************************************/
 157          /***********************************************************/
 158          void LcdStr(uchar x,uchar y,uchar *str,uchar mun){
 159   1        uchar i;
 160   1        LcdPos(x,y);
 161   1        for(i=0;i<mun;i++){
 162   2          LcdWriteBety(*str++,1);
 163   2        }
 164   1      }
 165          
 166          /***********************************************************/
 167          /***********************************************************/
 168          /***********************************************************/
 169          sbit LED=P1^0;
 170          /***********************************************************/
 171          /***********************************************************/
 172          /***********************************************************/
 173          
 174          /***********************************************************/
 175          /***********************************************************/
 176          /***********************************************************/   
 177          
C51 COMPILER V9.54   1602MODE4LINE                                                         05/07/2019 17:01:38 PAGE 4   

 178          void main(){
 179   1        
 180   1        LcdInit();
 181   1        LcdClread();
 182   1      
 183   1      /****************************************************/  
 184   1      //测屏代码
 185   1        CLK_DIV=0x02; //时钟分频   c51用不上，stc12c5404用
 186   1        while(1){ 
 187   2          
 188   2          WriteStr(1,1,dis1);
 189   2          WriteStr(1,2,dis2);
 190   2          LED = ~LED; 
 191   2         
 192   2        }  
 193   1      
 194   1      } 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    286    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     34       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
